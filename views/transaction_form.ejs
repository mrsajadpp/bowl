<h1>Transaction Form</h1>

<% if (error) { %>
    <p style="color: red; font-weight: bold;">
        <%= error %>
    </p>
<% } %>

<form id="transactionForm" action="/transactions" method="POST"
    style="max-width: 500px; margin: 0 auto; padding: 20px; border: 1px solid #ccc; border-radius: 8px; background-color: #f9f9f9;">
    <div style="margin-bottom: 15px;">
        <label for="transaction_date"
            style="font-size: 16px; font-weight: bold; display: block; margin-bottom: 5px;">Transaction
            Date:</label>
        <input type="date" id="transaction_date" name="transaction_date"
            value="<%= form_data ? form_data.transaction_date : '' %>"
            style="width: 100%; padding: 10px; font-size: 16px; border-radius: 5px; border: 1px solid #ccc;"
            required>
    </div>

    <div id="transactionsContainer">
        <div class="transaction-entry" style="margin-bottom: 15px;">
            
        </div>
    </div>

    <button type="button" id="addTransactionButton"
        style="width: 100%; padding: 12px 0; font-size: 18px; font-weight: bold; background-color: #0078e8; color: white; border: none; border-radius: 5px; cursor: pointer; margin-bottom: 10px;">Add Another Transaction</button>

    <button type="submit"
        style="width: 100%; padding: 12px 0; font-size: 18px; font-weight: bold; background-color: #0078e8; color: white; border: none; border-radius: 5px; cursor: pointer;">Submit</button>
</form>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const expenseCategories = [
            "Housing", "Utilities", "Groceries", "Transportation", "Healthcare", "Entertainment", "Dining Out", "Clothing",
            "Education", "Travel", "Personal Care", "Fitness", "Insurance", "Debt Repayment", "Savings", "Investments",
            "Technology", "Gifts", "Charity", "Childcare", "Pets", "Home Improvement", "Subscriptions", "Legal Fees",
            "Events and Celebrations", "Professional Services", "Taxes", "Luxury", "Hobbies", "Alcohol and Tobacco",
            "Fines and Penalties", "Miscellaneous"
        ];

        const receiveCategories = [
            "Salary", "Business Revenue", "Freelancing", "Investments", "Rental Income", "Government Benefits", "Gifts",
            "Inheritances", "Prizes", "Side Hustles", "Royalties", "Crowdfunding", "Refunds", "Grants", "Scholarships",
            "Tips", "Pension", "Dividends", "Alimony/Child Support", "Stock Sales", "Affiliate Marketing", "Consulting Fees",
            "Event Hosting", "Intellectual Property", "Barter or Trade", "Cryptocurrency", "Reselling", "Loans",
            "Partnership Shares", "Carpool Income", "Miscellaneous"
        ];

        const transactionsContainer = document.getElementById('transactionsContainer');
        const addTransactionButton = document.getElementById('addTransactionButton');

        function populateCategories(selectElement, categories) {
            selectElement.innerHTML = '';
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category.toLowerCase().replace(/ /g, '_');
                option.textContent = category;
                selectElement.appendChild(option);
            });
        }

        function addTransactionEntry() {
            const transactionEntry = document.createElement('div');
            transactionEntry.className = 'transaction-entry';
            transactionEntry.style.marginBottom = '15px';
            transactionEntry.innerHTML = `
                <div style="margin-bottom: 15px;">
                    <label for="amount" style="font-size: 16px; font-weight: bold; display: block; margin-bottom: 5px;">Amount:</label>
                    <input type="number" name="amount" step="0.01" style="width: 100%; padding: 10px; font-size: 16px; border-radius: 5px; border: 1px solid #ccc;" required>
                </div>
                <div style="margin-bottom: 15px;">
                    <label for="transaction_type" style="font-size: 16px; font-weight: bold; display: block; margin-bottom: 5px;">Transaction Type:</label>
                    <select name="transaction_type" style="width: 100%; padding: 10px; font-size: 16px; border-radius: 5px; border: 1px solid #ccc;" required>
                        <option value="income">Income</option>
                        <option value="expense">Expense</option>
                    </select>
                </div>
                <div style="margin-bottom: 15px;">
                    <label for="category" style="font-size: 16px; font-weight: bold; display: block; margin-bottom: 5px;">Category:</label>
                    <select name="category" style="width: 100%; padding: 10px; font-size: 16px; border-radius: 5px; border: 1px solid #ccc;" required>
                        <!-- Options will be populated by JavaScript -->
                    </select>
                </div>
            `;
            transactionsContainer.appendChild(transactionEntry);

            const transactionTypeSelect = transactionEntry.querySelector('select[name="transaction_type"]');
            const categorySelect = transactionEntry.querySelector('select[name="category"]');

            transactionTypeSelect.addEventListener('change', function() {
                if (transactionTypeSelect.value === 'expense') {
                    populateCategories(categorySelect, expenseCategories);
                } else if (transactionTypeSelect.value === 'income') {
                    populateCategories(categorySelect, receiveCategories);
                }
            });

            // Initial population based on the current selection
            if (transactionTypeSelect.value === 'expense') {
                populateCategories(categorySelect, expenseCategories);
            } else if (transactionTypeSelect.value === 'income') {
                populateCategories(categorySelect, receiveCategories);
            }
        }

        addTransactionButton.addEventListener('click', addTransactionEntry);

        // Add the first transaction entry on page load
        addTransactionEntry();
    });
</script>